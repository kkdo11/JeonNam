<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<!--<html lang="en">-->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="author" content="Untree.co">
    <link rel="shortcut icon" href="/images/JN_favicon.png">

    <meta name="description" content=""/>
    <meta name="keywords" content="bootstrap, bootstrap4"/>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Source+Serif+Pro:wght@400;700&display=swap"
          rel="stylesheet">

    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/owl.carousel.min.css">
    <link rel="stylesheet" href="/css/owl.theme.default.min.css">
    <link rel="stylesheet" href="/css/jquery.fancybox.min.css">
    <link rel="stylesheet" href="/fonts/icomoon/style.css">
    <link rel="stylesheet" href="/css/flaticon.css">
    <link rel="stylesheet" href="/css/daterangepicker.css">
    <link rel="stylesheet" href="/css/aos.css">
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>

    <style>
        /* ìƒì„¸ í˜ì´ì§€ íŠ¹ì • ìŠ¤íƒ€ì¼ */
        /* ì´ ì»¨í…Œì´ë„ˆëŠ” ì´ì œ ì§€ë„ì™€ ì •ë³´ë¥¼ í¬í•¨í•˜ëŠ” ë‘ ê°œì˜ ì»¬ëŸ¼ì„ ê°€ì§ˆ ê²ƒ */
        .detail-main-content {
            display: flex; /* ì§€ë„ì™€ ì •ë³´ ì˜ì—­ì„ ê°€ë¡œë¡œ ì •ë ¬ */
            flex-wrap: wrap; /* ì‘ì€ í™”ë©´ì—ì„œ ì¤„ë°”ê¿ˆ í—ˆìš© */
            gap: 30px; /* ì»¬ëŸ¼ ì‚¬ì´ ê°„ê²© */
            justify-content: center; /* ì „ì²´ ì½˜í…ì¸  ê°€ìš´ë° ì •ë ¬ */
            align-items: flex-start; /* ìƒë‹¨ ì •ë ¬ */
            padding: 40px 0;
        }

        /* ì¢Œì¸¡ ì§€ë„ ì˜ì—­ */
        .map-container-col {
            flex: 1 1 50%; /* flex grow, shrink, basis (ëŒ€ëµ 50% ë„ˆë¹„) */
            max-width: 50%; /* ìµœëŒ€ ë„ˆë¹„ ì„¤ì • */
            min-width: 300px; /* ìµœì†Œ ë„ˆë¹„ (ëª¨ë°”ì¼ì—ì„œ ê½‰ ì°¨ë„ë¡) */
            /*height: 500px; !* ì§€ë„ ì˜ì—­ ë†’ì´ ê³ ì • (ì¡°ì • í•„ìš”) *!*/
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            overflow: hidden; /* ì§€ë„ê°€ ë„˜ì¹˜ì§€ ì•Šë„ë¡ */
        }

        .map-placeholder {
            width: 100%;
            height: 100%;
            background-color: #e0e0e0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5em;
            color: #666;
        }

        /* ìš°ì¸¡ ì •ë³´ ì˜ì—­ (í¬ìŠ¤í„°ì™€ ìƒì„¸ ì •ë³´ í¬í•¨) */
        .info-poster-container-col {
            flex: 1 1 45%; /* flex grow, shrink, basis (ëŒ€ëµ 45% ë„ˆë¹„) */
            max-width: 45%; /* ìµœëŒ€ ë„ˆë¹„ ì„¤ì • */
            min-width: 300px; /* ìµœì†Œ ë„ˆë¹„ */
            display: flex;
            flex-direction: column; /* í¬ìŠ¤í„°ì™€ ì •ë³´ë¥¼ ì„¸ë¡œë¡œ ìŒ“ìŒ */
            align-items: center; /* ë‚´ë¶€ ìš”ì†Œ ê°€ìš´ë° ì •ë ¬ */
            text-align: center;
        }

        .poster-area {
            width: 80%; /* ì •ë³´ ì»¨í…Œì´ë„ˆ ë‚´ì—ì„œ í¬ìŠ¤í„° ë„ˆë¹„ ì¡°ì • */
            max-width: 300px; /* í¬ìŠ¤í„° ìµœëŒ€ ë„ˆë¹„ */
            margin-bottom: 20px; /* í¬ìŠ¤í„° ì•„ë˜ ì—¬ë°± */
        }

        .poster-area img {
            width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            aspect-ratio: 2.5 / 4; /* í¬ìŠ¤í„° ë¹„ìœ¨ ìœ ì§€ */
            object-fit: cover;
            display: block;
        }

        .info-area {
            width: 100%; /* ì •ë³´ ì˜ì—­ì€ ë¶€ëª¨ ë„ˆë¹„ì— ë§ì¶¤ */
            text-align: center;
        }

        .info-area h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: #333;
        }

        .info-area p {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #555;
            margin-bottom: 10px;
        }

        .info-area strong {
            color: #000;
        }

        /* ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸° ë²„íŠ¼ */
        .back-button-container {
            margin-top: 30px;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 992px) {
            /* íƒœë¸”ë¦¿ ë° ëª¨ë°”ì¼ */
            .detail-main-content {
                flex-direction: column; /* ì„¸ë¡œë¡œ ìŒ“ì´ë„ë¡ ë³€ê²½ */
                align-items: center; /* ê°€ìš´ë° ì •ë ¬ */
                gap: 20px;
            }

            .map-container-col,
            .info-poster-container-col {
                width: 90%; /* í™”ë©´ ê½‰ ì±„ìš°ë„ë¡ */
                max-width: 600px; /* ë„ˆë¬´ ì»¤ì§€ì§€ ì•Šë„ë¡ ìµœëŒ€ ë„ˆë¹„ ì„¤ì • */
                min-width: auto;
                height: 350px; /* ëª¨ë°”ì¼ì—ì„œ ì§€ë„ ë†’ì´ ì¡°ì • */
            }

            .info-poster-container-col {
                height: auto; /* ì •ë³´ ì˜ì—­ ë†’ì´ ìë™ */
            }

            .info-area h1 {
                font-size: 2rem;
            }

            .info-area p {
                font-size: 1rem;
            }
            #location-caption {
                min-height: 90px; /* ë„ˆë¬´ ë†’ê²Œ ëŠ˜ì–´ë‚˜ì§€ ì•Šê²Œ */
            }


        }
    </style>
    <!-- jquery -->
    <script type="text/javascript" src="/js/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" src="/js/jquery.serializeObject.min.js"></script>


    <!-- ì§€ë„ -->
    <!-- 1. Kakao SDK (autoload=false ì„¤ì •) -->
    <!-- Kakao SDK - autoload false -->
    <script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=15f402ba36aeaab14a6b06f5dd3f796e&autoload=false&libraries=services"></script>


    <!-- 2. ì§€ë„ ì´ˆê¸°í™” í•¨ìˆ˜ í¬í•¨ëœ ìŠ¤í¬ë¦½íŠ¸ -->
    <script type="text/javascript" src="/js/movieDetail.js"></script>


    <!-- 3. Kakao SDKê°€ ë¡œë“œë˜ë©´ initMap ì‹¤í–‰ -->
    <script>
        window.onload = function () {
            if (typeof kakao !== 'undefined' && kakao.maps && kakao.maps.load) {
                kakao.maps.load(function () {
                    if (typeof initMap === 'function') {
                        initMap();
                    } else {
                        console.error("âŒ initMap í•¨ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.");
                    }
                });
            } else {
                console.error("âŒ Kakao ì§€ë„ SDKê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
            }
        };
    </script>

    <title>ì˜í™” ìƒì„¸ ì •ë³´</title>
</head>

<body>

<div class="site-mobile-menu site-navbar-target">
    <div class="site-mobile-menu-header">
        <div class="site-mobile-menu-close">
            <span class="icofont-close js-menu-toggle"></span>
        </div>
    </div>
    <div class="site-mobile-menu-body"></div>
</div>

<nav class="site-nav">
    <div class="container">
        <div class="site-navigation">
            <a href="/user/index" class="logo m-0">
                <img src="/images/JN_logo_nobg.png" alt="ì „ë‚¨ì™€ë”° ë¡œê³ " style="height: 4rem;">
            </a>

            <ul class="js-clone-nav d-none d-lg-inline-block text-left site-menu float-right">
                <li><a href="/user/index">í™ˆ</a></li>
                <li class="active"><a href="/movie">ë¯¸ë””ì–´ ì—¬í–‰</a></li>
                <li><a href="services.html">í…Œë§ˆ ì—¬í–‰</a></li>
                <li><a href="about.html">AI ì¶”ì²œ ì—¬í–‰</a></li>
                <li><a href="contact.html">ì „ë‚¨ ë¨¹ê±°ë¦¬</a></li>
                <!-- ë¡œê·¸ì¸ ì—¬ë¶€ì— ë”°ë¼ ì¡°ê±´ ë¶„ê¸° -->
                <li th:if="${session.email == null}">
                    <a href="/user/login">ë¡œê·¸ì¸</a>
                </li>
                <li th:if="${session.email != null}">
                    <a href="/user/logout">ë¡œê·¸ì•„ì›ƒ</a>
                </li>
            </ul>

            <a href="#"
               class="burger ml-auto float-right site-menu-toggle js-menu-toggle d-inline-block d-lg-none light"
               data-toggle="collapse" data-target="#main-navbar">
                <span></span>
            </a>

        </div>
    </div>
</nav>

<div class="hero hero-inner">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6 mx-auto text-center">
                <div class="intro-wrap">
                    <h1 class="mb-0" id="detail-page-title">ì˜í™” ìƒì„¸ ì •ë³´</h1>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="untree_co-section">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="detail-main-content">
                    <div class="map-container-col">
                        <div id="map-area" data-latitude="34.62939" data-longitude="126.90022"
                             style="width:100%; height:460px;"></div>

                        <!-- ìœ„ì¹˜ ë° ê°ì„± ë©˜íŠ¸ í‘œì‹œ ì˜ì—­ -->
                        <div id="location-caption" class="mt-3 text-center">
<!--                            <p id="detail-place-text" style="font-weight: bold; font-size: 1.1rem;">ğŸ“ ì¥ì†Œ ì •ë³´ ë¡œë”© ì¤‘...</p>-->
                            <p id="emotion-text" class="text-muted">âœ¨ ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</p>
                            <!-- ì°œí•˜ê¸° ë²„íŠ¼ -->
                            <button id="favorite-btn" class="btn-favorite" style="
    margin-bottom: 30px;
    margin-top: 10px;
">
                                <iconify-icon id="favorite-icon" icon="mdi:heart-outline" width="22"></iconify-icon>
                                <span>ë‚˜ë§Œì˜ ì—¬ì •ì— ë‹´ê¸°</span>
                            </button>




                            <!--                            <button id="favorite-btn" class="btn btn-outline-danger" style="-->
<!--    margin-bottom: 20px;">-->
<!--                                <iconify-icon id="favorite-icon" icon="mdi:heart-outline" width="24"></iconify-icon>-->
<!--                                ì°œí•˜ê¸°-->
<!--                            </button>-->
                        </div>

                    </div>


                    <div class="info-poster-container-col">
                        <div class="poster-area">
                            <img id="detail-poster-url" src="/images/loading.gif" alt="ì˜í™” í¬ìŠ¤í„° ë¡œë”© ì¤‘">
                            <div class="favorite-button-container mt-3"></div>
                        </div>
                        <div class="info-area">
                            <h1 id="detail-movie-name">ë¡œë”© ì¤‘...</h1>
                            <p><strong>ğŸ“ ì¥ì†Œ : </strong> <span id="detail-place">ë¡œë”© ì¤‘...</span></p>
                        </div>
<!--                        &lt;!&ndash; ì°œí•˜ê¸° ë²„íŠ¼ &ndash;&gt;-->
<!--                        <button id="favorite-btn" class="btn btn-outline-danger">-->
<!--                            <iconify-icon id="favorite-icon" icon="mdi:heart-outline" width="24"></iconify-icon>-->
<!--                            ì°œí•˜ê¸°-->
<!--                        </button>-->

                    </div>
                </div>
            </div>
        </div>

        <div class="row justify-content-center back-button-container">
            <div class="col-12 text-center">
                <button class="btn btn-primary" onclick="window.location.href='/movie'">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
            </div>
        </div>
    </div>
</div>

<div class="site-footer">
    <div class="inner first">
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-lg-6">
                    <div class="widget">
                        <h3 class="heading">ì„œë¹„ìŠ¤ ì•ˆë‚´</h3>
                        <p>ì´ ì„œë¹„ìŠ¤ëŠ” 2025ë…„ ì „ë¼ë‚¨ë„ ê³µê³µá†ë¹…ë°ì´í„° í™œìš© ì•„ì´ë””ì–´ ê³µëª¨ì „ ì¶œí’ˆì‘ì…ë‹ˆë‹¤.<br>
                            ì „ë¼ë‚¨ë„ì˜ ë°©ëŒ€í•œ ê³µê³µ ë°ì´í„°ì™€ ë¹…ë°ì´í„°ë¥¼ ì°½ì˜ì ìœ¼ë¡œ í™œìš©í•˜ì—¬,
                            ì—¬í–‰ìë“¤ì—ê²Œ ë”ìš± í’ë¶€í•˜ê³  ê°œì¸í™”ëœ ê²½í—˜ì„ ì œê³µí•˜ê³ ì ê¸°íšë˜ì—ˆìŠµë‹ˆë‹¤.
                            ë‚¨ë„ì˜ ìˆ¨ê²¨ì§„ ë§¤ë ¥ì„ ë°œê²¬í•˜ê³ , íŠ¹ë³„í•œ ì¶”ì–µì„ ë§Œë“¤ì–´ ê°ˆ ìˆ˜ ìˆë„ë¡
                            ìµœì ì˜ ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” ë° ì´ˆì ì„ ë§ì¶”ê³  ìˆìŠµë‹ˆë‹¤.
                            <br>ì§€ê¸ˆ ë°”ë¡œ ì „ë¼ë‚¨ë„ì˜ ë§¤ë ¥ì„ ì§ì ‘ ê²½í—˜í•´ë³´ì„¸ìš”!</p>
                    </div>
                </div>
                <div class="col-md-7 col-lg-2 pl-lg-5">
                    <div class="widget">
                        <h3 class="heading">Pages</h3>
                        <ul class="links list-unstyled">
                            <li><a href="#">ë¯¸ë””ì–´ ì—¬í–‰</a></li>
                            <li><a href="#">í…Œë§ˆ ì—¬í–‰</a></li>
                            <li><a href="#">AI ì¶”ì²œ ì—¬í–‰</a></li>
                            <li><a href="#">ì „ë‚¨ ë¨¹ê±°ë¦¬</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="widget">
                        <h3 class="heading">Contact</h3>
                        <ul class="list-unstyled quick-info links">
                            <li class="email"><a href="#">poly@example.com</a></li>
                            <li class="phone"><a href="#">+82 02-2186-5800</a></li>
                            <li class="address"><a href="#">ì„œìš¸íŠ¹ë³„ì‹œ ê°•ì„œêµ¬ í™”ê³¡ë™ ìš°ì¥ì‚°ë¡œ10ê¸¸ 112</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="inner dark">
        <div class="container">
            <div class="row text-center">
                <div class="col-md-8 mb-3 mb-md-0 mx-auto">
                    <p>Copyright &copy;<script>document.write(new Date().getFullYear());</script>
                        . All Rights Reserved. &mdash; Designed with love by Team ì•„ë”°
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="/js/jquery-3.4.1.min.js"></script>
<script src="/js/popper.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/owl.carousel.min.js"></script>
<script src="/js/jquery.animateNumber.min.js"></script>
<script src="/js/jquery.waypoints.min.js"></script>
<script src="/js/jquery.fancybox.min.js"></script>
<script src="/js/aos.js"></script>
<script src="/js/moment.min.js"></script>
<script src="/js/daterangepicker.js"></script>
<script src="/js/typed.js"></script>
<script src="/js/custom.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const detailPosterUrlElem = document.getElementById('detail-poster-url');
        const detailMovieNameElem = document.getElementById('detail-movie-name');
        const detailPlaceElem = document.getElementById('detail-place');
        const detailPageTitleElem = document.getElementById('detail-page-title'); // í˜ì´ì§€ ìƒë‹¨ ì œëª©

        const urlParams = new URLSearchParams(window.location.search);
        const movieId = urlParams.get('id');

        // const detailPlaceText = document.getElementById('detail-place-text');
        const emotionText = document.getElementById('emotion-text');

        const mediaMentions = [
            "ğŸ¬ í™”ë©´ ì† ì¥ë©´ì´ ì‹œì‘ëœ ì´ê³³, ì´ì œ ë‹¹ì‹ ì˜ ì—¬í–‰ì§€ê°€ ë©ë‹ˆë‹¤!",
            "ğŸ‘£ ìµìˆ™í•œ ì¥ë©´ì˜ ë°°ê²½, ì§ì ‘ ê±¸ì–´ë³´ë©´ ì „í˜€ ë‹¤ë¥¸ ê°ë™ì´ ìˆì–´ìš”!",
            "ğŸ¥ ì¹´ë©”ë¼ ë„ˆë¨¸ì˜ ì§„ì§œ ì´ì•¼ê¸°ë¥¼, ì´ê³³ì—ì„œ ëŠê»´ë³´ì„¸ìš”!",
            "ğŸ§­ ì´ ì¥ë©´, ì–´ë””ì„œ ë´¤ë”ë¼? ë°”ë¡œ ë‹¹ì‹ ì˜ ê¸°ì–µ ì† ê·¸ê³³ì´ì—ìš”!",
            "ğŸ’¬ ë“œë¼ë§ˆ ì† ëŒ€ì‚¬ ìƒê°ë‚˜ì£ ? ì—¬ê¸°ê°€ ë°”ë¡œ ê·¸ ì¥ë©´ì´ì—ìš”!",
            "ğŸ‰ ì§€ê¸ˆ ì´ê³³, ë‚˜ë„ ì½˜í…ì¸ ì˜ ì£¼ì¸ê³µâœ¨ ëœ ê¸°ë¶„!"
        ];



        if (movieId) {
            fetch(`/api/movies/detail?id=${movieId}`)
                .then(response => {
                    if (response.status === 404) {
                        throw new Error('ì˜í™” ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }
                    if (!response.ok) {
                        throw new Error(`ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${response.status} ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data) {
                        detailPosterUrlElem.src = data.posterUrl;
                        detailPosterUrlElem.alt = data.title;
                        detailMovieNameElem.textContent = data.title;
                        detailPlaceElem.textContent = data.location;
                        detailPageTitleElem.textContent = data.title;

                        // âœ… ì§€ë„ ì•„ë˜ ìœ„ì¹˜ ì •ë³´ ë° ê°ì„± ë©˜íŠ¸ ì¶œë ¥
                        // detailPlaceText.textContent = `ğŸ“ ${data.location}`;
                        emotionText.textContent = mediaMentions[Math.floor(Math.random() * mediaMentions.length)];


                        const lat = data.y;
                        const lon = data.x;

                        const mapArea = document.getElementById('map-area');
                        if (mapArea) {
                            mapArea.dataset.latitude = lat;
                            mapArea.dataset.longitude = lon;
                        }



                        // ì°œ ì—¬ë¶€ í™•ì¸ ì‹¤í–‰
                        checkFavoriteStatus(data.title, data.location);

                    } else {
                        detailMovieNameElem.textContent = 'ì˜í™” ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                        detailPlaceElem.textContent = '';
                        detailPosterUrlElem.src = '';
                        detailPosterUrlElem.alt = 'ì •ë³´ ì—†ìŒ';
                        detailPageTitleElem.textContent = 'ì •ë³´ ì—†ìŒ';
                        console.warn('ë°›ì•„ì˜¨ ì˜í™” ìƒì„¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    }
                })
                .catch(error => {
                    console.error('ì˜í™” ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:', error);
                    detailMovieNameElem.textContent = 'ì •ë³´ ë¡œë”© ì¤‘ ì˜¤ë¥˜ ë°œìƒ';
                    detailPlaceElem.textContent = error.message;
                    detailPosterUrlElem.src = '';
                    detailPosterUrlElem.alt = 'ì—ëŸ¬';
                    detailPageTitleElem.textContent = 'ì˜¤ë¥˜';
                });
        } else {
            detailMovieNameElem.textContent = 'ìœ íš¨í•œ ì˜í™” IDê°€ ì œê³µë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.';
            detailPlaceElem.textContent = '';
            detailPosterUrlElem.src = '';
            detailPosterUrlElem.alt = 'ID ì—†ìŒ';
            detailPageTitleElem.textContent = 'ì˜ëª»ëœ ì ‘ê·¼';
            console.warn('URLì— ì˜í™” IDê°€ ì—†ìŠµë‹ˆë‹¤.');
        }

        const favoriteBtn = document.getElementById('favorite-btn');
        if (favoriteBtn) {
            favoriteBtn.addEventListener('click', handleFavoriteClick);
        }
    });

    async function checkFavoriteStatus(title, location) {
        try {
            const res = await fetch(`/favorite/check?type=media&name=${encodeURIComponent(title)}&location=${encodeURIComponent(location)}`);
            const favIcon = document.getElementById('favorite-icon');

            if (res.ok) {
                const isFavorite = await res.json();
                if (favIcon) {
                    favIcon.setAttribute('icon', isFavorite ? 'mdi:heart' : 'mdi:heart-outline');
                }
            } else if (res.status === 401) {
                console.log("ë¡œê·¸ì¸ ìƒíƒœê°€ ì•„ë‹™ë‹ˆë‹¤. ì°œ ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ì•„ì´ì½˜ì€ ë¹ˆ í•˜íŠ¸)");
                if (favIcon) {
                    favIcon.setAttribute('icon', 'mdi:heart-outline');
                }
            } else {
                console.error('ì°œ ì—¬ë¶€ í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', res.status, res.statusText);
                if (favIcon) {
                    favIcon.setAttribute('icon', 'mdi:heart-outline');
                }
            }
        } catch (err) {
            console.error('ì°œ ì—¬ë¶€ í™•ì¸ ì‹¤íŒ¨ (ë„¤íŠ¸ì›Œí¬ ë“±):', err);
            const favIcon = document.getElementById('favorite-icon');
            if (favIcon) {
                favIcon.setAttribute('icon', 'mdi:heart-outline');
            }
        }
    }

    async function handleFavoriteClick() {
        const title = document.getElementById('detail-movie-name').textContent;
        const location = document.getElementById('detail-place').textContent;
        const posterUrl = document.getElementById('detail-poster-url').src;
        const mapArea = document.getElementById('map-area');
        const latitude = mapArea ? mapArea.dataset.latitude : null;
        const longitude = mapArea ? mapArea.dataset.longitude : null;

        const favIcon = document.getElementById('favorite-icon');
        let isCurrentlyFavorite = favIcon.getAttribute('icon') === 'mdi:heart';

        try {
            const loginCheckRes = await fetch('/auth/check-login');
            if (loginCheckRes.status === 401) {
            alert('ì°œ ê¸°ëŠ¥ì„ ì´ìš©í•˜ì‹œë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');// ìˆ˜ì •ëœ ë©”ì‹œì§€
                window.location.href = '/user/login';
                return;
            }
            if (!loginCheckRes.ok) {
            alert('ì„œë¹„ìŠ¤ ì´ìš©ì— ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì‹­ì‹œì˜¤.'); // ìˆ˜ì •ëœ ë©”ì‹œì§€
                console.error('ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', loginCheckRes.status, loginCheckRes.statusText);
                return;
            }

            this.disabled = true;

            if (isCurrentlyFavorite) {
                const res = await fetch(`/favorite?type=media&name=${encodeURIComponent(title)}&location=${encodeURIComponent(location)}`, {
                    method: 'DELETE'
                });

                if (!res.ok) {
                    throw new Error('ì°œ ì·¨ì†Œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì‹­ì‹œì˜¤.'); // ìˆ˜ì •ëœ ë©”ì‹œì§€
                }

            alert(`"${title}" ì˜í™”ê°€ ì°œ ëª©ë¡ì—ì„œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.`); // ìˆ˜ì •ëœ ë©”ì‹œì§€
                favIcon.setAttribute('icon', 'mdi:heart-outline');
            } else {
                const favoriteDTO = {
                    type: 'media',
                    name: title || '',
                    location: location || '',
                    posterUrl: posterUrl || '',
                    x: longitude || null,
                    y: latitude || null,
                    planPhone: null,
                    planHomepage: null,
                    planParking: null,
                    planContents: null
                };

                const res = await fetch('/favorite', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(favoriteDTO)
                });

                if (!res.ok) {
                    throw new Error('ì°œ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì‹­ì‹œì˜¤.'); // ìˆ˜ì •ëœ ë©”ì‹œì§€
                }
                const data = await res.json();

            alert(`"${data.name}" ì˜í™”ê°€ ì°œ ëª©ë¡ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`); // ìˆ˜ì •ëœ ë©”ì‹œì§€
                favIcon.setAttribute('icon', 'mdi:heart');
            }
        } catch (err) {
            console.error('ì°œ ê¸°ëŠ¥ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:', err);
        alert(`ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${err.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì‹­ì‹œì˜¤.`); // ìˆ˜ì •ëœ ë©”ì‹œì§€
        } finally {
            this.disabled = false;
        }
    }
</script>
<style>
    .btn-favorite {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 12px 26px;
        background: linear-gradient(135deg, #ffa84c, #ff7b00);
        color: #fff;
        font-size: 16px;
        font-weight: 600;
        border: none;
        border-radius: 999px;
        transition: all 0.3s ease;
        box-shadow: 0 6px 15px rgba(255, 123, 0, 0.25);
        cursor: pointer;
        font-family: 'Inter', 'Noto Sans KR', sans-serif;
    }

    .btn-favorite iconify-icon {
        transition: transform 0.2s ease;
        color: inherit;
        width: 20px;
        height: 20px;
    }

    .btn-favorite:hover {
        background: linear-gradient(135deg, #ff7b00, #ffa84c);
        transform: translateY(-3px);
        box-shadow: 0 10px 25px rgba(255, 123, 0, 0.4);
    }

    .btn-favorite:hover iconify-icon {
        transform: scale(1.2);
    }

    .btn-favorite.active {
        background: #ff7b00;
        box-shadow: 0 8px 20px rgba(255, 123, 0, 0.35);
    }

    .btn-favorite.active iconify-icon {
        transform: scale(1.1);
        color: #fff;
    }
</style>


</body>
</html>